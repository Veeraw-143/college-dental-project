{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Surabi Dental Clinic{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero" aria-labelledby="hero-heading">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <h2 id="hero-heading">Healthy Teeth, Confident Smile</h2>
        <p class="lead">Advanced dental care with a gentle touch.</p>
        <div class="hero-ctas">
            <a class="btn btn-primary" href="{% url 'home' %}#appointment">Book Appointment</a>
            <a class="btn btn-outline" href="{% url 'services' %}">View Services</a>
        </div>
    </div>

    <div class="hero-media" aria-hidden="true">
        <img src="{% static 'media/bg2.webp' %}" alt="Smiling dentist with patient" loading="lazy" decoding="async">
        <img src="{% static 'media/bg3.webp' %}" alt="Child Dentistry" loading="lazy" decoding="async">
    </div>
</section>

<!-- Quick Stats -->
<section class="quick-stats reveal" style="padding: 40px 12px; background: linear-gradient(135deg, #2fa4a9, #1e7c81); color: white; text-align: center;">
    <div class="container">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
            <div>
                <h3 style="font-size: 32px; margin-bottom: 8px;">15+</h3>
                <p>Years Experience</p>
            </div>
            <div>
                <h3 style="font-size: 32px; margin-bottom: 8px;">5000+</h3>
                <p>Happy Patients</p>
            </div>
            <div>
                <h3 style="font-size: 32px; margin-bottom: 8px;">10+</h3>
                <p>Expert Doctors</p>
            </div>
            <div>
                <h3 style="font-size: 32px; margin-bottom: 8px;">24/7</h3>
                <p>Emergency Care</p>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials -->
<section class="testimonials reveal" id="testimonials" aria-labelledby="testimonials-heading" style="padding: 40px 12px;">
  <div class="container">
    <h2 id="testimonials-heading" style="text-align: center; margin-bottom: 30px;">What our patients say</h2>
    <div class="testimonials-grid">
      {% if feedbacks %}
        {% for feedback in feedbacks %}
          <blockquote class="testimonial">
            <p>"{{ feedback.message }}"</p>
            <cite>- {{ feedback.name }}</cite>
            {% if feedback.rating %}
              <div style="margin-top: 8px; color: #2fa4a9; font-size: 14px;">
                {% if feedback.rating == 5 %}★★★★★{% elif feedback.rating == 4 %}★★★★☆{% elif feedback.rating == 3 %}★★★☆☆{% elif feedback.rating == 2 %}★★☆☆☆{% else %}★☆☆☆☆{% endif %}
                ({{ feedback.rating }}/5)
              </div>
            {% endif %}
          </blockquote>
        {% endfor %}
      {% else %}
        <blockquote class="testimonial">
          <p>"The best dental experience I've ever had. Dr. Surabi and her team are wonderful!"</p>
          <cite>- Rajesh Kumar</cite>
        </blockquote>
        <blockquote class="testimonial">
          <p>"Professional service with a caring touch. Highly recommended for families!"</p>
          <cite>- Priya Sharma</cite>
        </blockquote>
        <blockquote class="testimonial">
          <p>"My smile has completely changed. Thank you, Surabi Dental!"</p>
          <cite>- Arjun Patel</cite>
        </blockquote>
      {% endif %}
    </div>
  </div>
</section>

<!-- Appointment Section -->
<section class="appointment" id="appointment">
    <div class="appointment-card">
        <h2>Book an Appointment</h2>
        <form id="appointment-form" method="POST" action="{% url 'booking' %}">
            {% csrf_token %}
            
            <!-- Email Verification Section -->
            <div id="otp-section" class="otp-verification" style="background: #f0f4f8; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2fa4a9;">
                <h3 style="margin-bottom: 15px;">Verify Email Address</h3>
                <div class="field">
                    <input type="email" id="email-otp" name="email_otp" placeholder=" " class="input-field">
                    <label for="email-otp">Email Address *</label>
                </div>
                <button type="button" id="send-otp-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Send OTP</button>
                
                <div id="otp-input-section" style="display: none; margin-top: 15px;">
                    <div class="field">
                        <input type="text" id="otp-code" maxlength="6" placeholder=" " class="input-field">
                        <label for="otp-code">Enter OTP *</label>
                    </div>
                    <button type="button" id="verify-otp-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Verify OTP</button>
                    <button type="button" id="resend-otp-btn" class="btn btn-outline" style="width: 100%;">Resend OTP</button>
                </div>
                
                <div id="otp-success" style="display: none; color: #4caf50; margin-top: 10px; padding: 12px; background-color: #e8f5e9; border-radius: 6px;">
                    ✓ Email verified successfully! Please fill in your appointment details below.
                </div>
            </div>
            
            <!-- Patient Information Section -->
            <h3>Patient Information</h3>
            <div class="field">
                <input type="text" id="name" name="name" placeholder=" " class="input-field">
                <label for="name">Full Name *</label>
            </div>
            <div class="field">
                <input type="email" id="mail" name="mail" placeholder=" " class="input-field">
                <label for="mail">Email Address *</label>
            </div>
            <div class="field">
                <input type="tel" id="mobile" name="mobile" placeholder=" " class="input-field">
                <label for="mobile">Mobile Number *</label>
            </div>
            
            <!-- Appointment Preferences Section -->
            <h3>Appointment Preferences</h3>
            <div class="field">
                <select id="doctor" name="doctor_id" class="input-field">
                    <option value="">-- Select Doctor --</option>
                    {% for doctor in doctors %}
                        <option value="{{ doctor.id }}">{{ doctor.name }} ({{ doctor.specialization }})</option>
                    {% endfor %}
                </select>
                <label for="doctor">Doctor</label>
            </div>
            <div class="field">
                <select id="service" name="service_id" class="input-field">
                    <option value="">-- Select Service --</option>
                    {% for service in services %}
                        <option value="{{ service.id }}">{{ service.name }}</option>
                    {% endfor %}
                </select>
                <label for="service">Service</label>
            </div>
            
            <!-- Appointment Date & Time Section -->
            <h3>Appointment Date & Time</h3>
            <div class="field">
                <input type="date" id="date" name="date" class="input-field">
                <label for="date">Select Date *</label>
            </div>
            
            <h3>Select Time Slot</h3>
            <div class="slot-grid" id="slot-grid">
                <p style="grid-column: 1/-1; text-align: center; color: #999;">Please select a date first</p>
            </div>
            <input type="hidden" id="time_slot" name="time_slot" value="">
            <input type="hidden" id="otp_verified" name="otp_verified" value="false">
            <div class="error" data-for="time_slot" aria-live="polite"></div>

            <div class="form-actions">
                <button type="submit" id="submit-btn" class="btn btn-primary">Book Appointment</button>
            </div>
            <div id="form-feedback" class="form-feedback" role="status" aria-live="polite"></div>
            {% if error %}
              <div class="form-feedback error-server" role="alert">{{ error }}</div>
            {% endif %}
            {% if success %}
              <div class="form-feedback success-server" role="status">{{ success }}</div>
            {% endif %}
        </form>
    </div>
</section>

{% endblock %}
